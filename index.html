<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tic Tac Master</title>
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
      import { getDatabase, ref, set, push, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA1B6aS-L2Celmq86GJvjK3AcLZsNIzHbo",
        authDomain: "tic-tac-toe-200b1.firebaseapp.com",
        databaseURL: "https://tic-tac-toe-200b1-default-rtdb.firebaseio.com",
        projectId: "tic-tac-toe-200b1",
        storageBucket: "tic-tac-toe-200b1.firebasestorage.app",
        messagingSenderId: "796321744752",
        appId: "1:796321744752:web:a413dc8c2ee7e24f0eb1b5",
        measurementId: "G-47SNJ7NQ3J"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getDatabase(app);
      
      // Make Firebase available globally
      window.firebaseDb = db;
      window.firebaseRef = ref;
      window.firebaseSet = set;
      window.firebaseOnValue = onValue;
    </script>

    <style>
        :root {
            --primary: #6c5ce7;
            --primary-dark: #5649c0;
            --secondary: #fd79a8;
            --success: #00b894;
            --danger: #d63031;
            --warning: #fdcb6e;
            --dark: #2d3436;
            --light: #f5f6fa;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.1);
            --glow: 0 0 20px rgba(108, 92, 231, 0.5);
            --transition: all 0.3s ease;
        }

        .theme-dark {
            --primary: #6c5ce7;
            --primary-dark: #5649c0;
            --secondary: #fd79a8;
            --success: #00b894;
            --danger: #d63031;
            --warning: #fdcb6e;
            --dark: #2d3436;
            --light: #f5f6fa;
            --bg-gradient: linear-gradient(135deg, #2d3436 0%, #636e72 100%);
            --card-bg: rgba(45, 52, 54, 0.7);
        }

        .theme-neon {
            --primary: #00cec9;
            --primary-dark: #00a8a3;
            --secondary: #e84393;
            --success: #00b894;
            --danger: #e84118;
            --warning: #fbc531;
            --dark: #2d3436;
            --light: #f5f6fa;
            --bg-gradient: linear-gradient(135deg, #0984e3 0%, #00cec9 100%);
            --card-bg: rgba(0, 206, 201, 0.1);
        }

        .theme-pastel {
            --primary: #a29bfe;
            --primary-dark: #817bfe;
            --secondary: #fd79a8;
            --success: #55efc4;
            --danger: #ff7675;
            --warning: #ffeaa7;
            --dark: #2d3436;
            --light: #f5f6fa;
            --bg-gradient: linear-gradient(135deg, #fd79a8 0%, #a29bfe 100%);
            --card-bg: rgba(253, 121, 168, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg-gradient);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.5s ease;
        }

        /* Particle Background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0;
            }
        }

        /* Screen Management */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            overflow-y: auto;
        }

        .screen.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Opening Animation */
        .opening-container {
            text-align: center;
        }

        .board-animation {
            width: 300px;
            height: 300px;
            margin: 0 auto 30px;
            position: relative;
            opacity: 0;
            transform: scale(0.8);
            animation: boardAppear 2s forwards 0.5s;
        }

        @keyframes boardAppear {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .grid-line {
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 2px;
        }

        .grid-line.horizontal {
            width: 100%;
            height: 4px;
            left: 0;
        }

        .grid-line.vertical {
            width: 4px;
            height: 100%;
            top: 0;
        }

        .grid-line:nth-child(1) { top: 33.33%; }
        .grid-line:nth-child(2) { top: 66.66%; }
        .grid-line:nth-child(3) { left: 33.33%; }
        .grid-line:nth-child(4) { left: 66.66%; }

        .title {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(to right, #fff, var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            opacity: 0;
            animation: titleFade 1.5s forwards 1.5s;
        }

        @keyframes titleFade {
            to {
                opacity: 1;
            }
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0;
            animation: subtitleFade 1s forwards 2.5s;
        }

        @keyframes subtitleFade {
            to {
                opacity: 0.8;
            }
        }

        /* Username Entry */
        .username-container {
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--glow);
            width: 100%;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: var(--transition);
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(108, 92, 231, 0.5);
        }

        input.error {
            border-color: var(--danger);
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        .error-message {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .btn {
            padding: 15px 30px;
            border-radius: 10px;
            border: none;
            background: var(--primary);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-block;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(108, 92, 231, 0.4);
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 92, 231, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Dashboard */
        .dashboard-container {
            width: 100%;
            max-width: 1200px;
            padding: 20px;
        }

        .profile-section {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: var(--glow);
        }

        .profile-info {
            flex: 1;
            min-width: 200px;
        }

        .username-display {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .level-display {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .xp-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .xp-progress {
            height: 100%;
            background: var(--success);
            border-radius: 5px;
            width: 0%;
            transition: width 1s ease;
        }

        .stats {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            min-width: 70px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .menu-item {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .menu-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .menu-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .menu-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .menu-desc {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Game Modes */
        .modes-container {
            width: 100%;
            max-width: 1000px;
            padding: 20px;
        }

        .modes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .mode-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .mode-card.featured {
            border: 2px solid var(--secondary);
        }

        .mode-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--secondary);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .mode-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .mode-desc {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .mode-xp {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            margin-top: 15px;
        }

        .xp-value {
            color: var(--warning);
            font-weight: 600;
        }

        /* AI Difficulty */
        .difficulty-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }

        .difficulty-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .difficulty-option {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .difficulty-option:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .difficulty-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .difficulty-info {
            flex: 1;
        }

        .difficulty-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .difficulty-desc {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Versus Animation */
        .versus-container {
            text-align: center;
            padding: 20px;
        }

        .versus-animation {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .player-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            width: 150px;
            text-align: center;
            box-shadow: var(--glow);
            opacity: 0;
            transform: translateY(20px);
        }

        .player-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .player-symbol {
            font-size: 2rem;
            font-weight: bold;
        }

        .vs-text {
            font-size: 2rem;
            font-weight: 700;
            color: var(--secondary);
            opacity: 0;
        }

        .energy-clash {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--secondary) 0%, transparent 70%);
            opacity: 0;
            filter: blur(10px);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 0.9; }
        }

        /* Game Board */
        .game-container {
            width: 100%;
            max-width: 600px;
            text-align: center;
            padding: 20px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .current-player {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-gap: 10px;
            margin: 0 auto 30px;
            max-width: min(90vw, 400px);
            aspect-ratio: 1/1;
        }

        .cell {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(2rem, 8vw, 3rem);
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            aspect-ratio: 1/1;
        }

        .cell:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        .cell.x {
            color: var(--primary);
        }

        .cell.o {
            color: var(--secondary);
        }

        .winning-cell {
            animation: glow 1.5s infinite alternate;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 5px rgba(108, 92, 231, 0.5);
            }
            to {
                box-shadow: 0 0 20px rgba(108, 92, 231, 0.9);
            }
        }

        .game-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Results Popup */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .popup-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .popup {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: var(--glow);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .popup-overlay.active .popup {
            transform: scale(1);
        }

        .popup-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .popup-message {
            font-size: 1.2rem;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .popup-xp {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

        .xp-icon {
            color: var(--warning);
        }

        .popup-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Statistics */
        .stats-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-card .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-card .stat-label {
            font-size: 1rem;
        }

        .progress-container {
            margin-top: 30px;
        }

        .progress-item {
            margin-bottom: 20px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 5px;
            width: 0%;
            transition: width 1s ease;
        }

        /* Settings */
        .settings-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            gap: 10px;
        }

        .setting-info {
            flex: 1;
            min-width: 200px;
        }

        .setting-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .setting-desc {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        /* Back Button */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.2rem;
            z-index: 10;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        /* Achievement System */
        .achievements-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .achievement-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .achievement-card.locked {
            opacity: 0.6;
            filter: grayscale(1);
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .achievement-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .achievement-desc {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .achievement-progress {
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .achievement-progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 3px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .achievement-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--warning);
            color: var(--dark);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Daily Rewards */
        .daily-rewards-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }

        .rewards-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .reward-day {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px 10px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .reward-day.claimed {
            background: var(--success);
            color: white;
        }

        .reward-day.available {
            background: var(--primary);
            color: white;
            animation: pulse 2s infinite;
        }

        .reward-day.future {
            opacity: 0.5;
        }

        .reward-xp {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .reward-day-label {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .streak-info {
            text-align: center;
            margin-top: 20px;
            font-size: 1.1rem;
        }

        /* Themes */
        .themes-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }

        .themes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .theme-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .theme-card.active {
            border-color: var(--primary);
        }

        .theme-card:hover {
            transform: translateY(-5px);
        }

        .theme-preview {
            width: 100%;
            height: 100px;
            border-radius: 10px;
            margin-bottom: 15px;
            background: var(--bg-gradient);
        }

        .theme-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* Leaderboard Styles */
        .leaderboard-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
        }

        .leaderboard-header {
            display: grid;
            grid-template-columns: 80px 1fr 100px;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            font-weight: 600;
            text-align: center;
        }

        .leaderboard-list {
            min-height: 200px;
        }

        .leaderboard-item {
            display: grid;
            grid-template-columns: 80px 1fr 100px;
            padding: 15px 20px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: var(--transition);
            text-align: center;
        }

        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .leaderboard-item.current-user {
            background: rgba(108, 92, 231, 0.2);
            border-left: 4px solid var(--primary);
        }

        .leaderboard-rank {
            font-weight: 700;
            color: var(--warning);
        }

        .leaderboard-name {
            text-align: left;
            padding-left: 15px;
        }

        .leaderboard-score {
            font-weight: 600;
            color: var(--success);
        }

        .loading-message, .error-message {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.7;
        }

        .leaderboard-item.rank-1 {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border-left: 4px solid gold;
        }

        .leaderboard-item.rank-2 {
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.2), rgba(192, 192, 192, 0.1));
            border-left: 4px solid silver;
        }

        .leaderboard-item.rank-3 {
            background: linear-gradient(135deg, rgba(205, 127, 50, 0.2), rgba(205, 127, 50, 0.1));
            border-left: 4px solid #cd7f32;
        }

        /* Tournament Mode */
        .tournament-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
        }

        .tournament-bracket {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .tournament-round {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .round-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
        }

        .tournament-match {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .match-player {
            flex: 1;
            text-align: center;
        }

        .match-vs {
            margin: 0 10px;
            opacity: 0.7;
        }

        .match-winner {
            font-weight: 600;
            color: var(--success);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: var(--glow);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .notification-message {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Tutorial */
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .tutorial-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        .tutorial-card {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--glow);
        }

        .tutorial-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .tutorial-content {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .tutorial-indicators {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tutorial-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .tutorial-indicator.active {
            background: var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .game-board {
                max-width: min(90vw, 350px);
            }
            
            .versus-animation {
                flex-direction: column;
                gap: 20px;
            }
            
            .popup-buttons {
                flex-direction: column;
            }
            
            .profile-section {
                justify-content: center;
                text-align: center;
            }

            .rewards-calendar {
                grid-template-columns: repeat(4, 1fr);
            }

            .themes-grid {
                grid-template-columns: 1fr;
            }

            .leaderboard-header, .leaderboard-item {
                grid-template-columns: 60px 1fr 80px;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 2rem;
            }
            
            .card {
                padding: 20px;
            }
            
            .profile-section {
                flex-direction: column;
            }
            
            .game-board {
                max-width: min(90vw, 300px);
            }
            
            .game-header {
                flex-direction: column;
            }
            
            .menu-grid {
                grid-template-columns: 1fr;
            }
            
            .modes-grid {
                grid-template-columns: 1fr;
            }

            .rewards-calendar {
                grid-template-columns: repeat(3, 1fr);
            }

            .leaderboard-header, .leaderboard-item {
                grid-template-columns: 50px 1fr 70px;
                padding: 10px 15px;
            }
        }

        @media (max-height: 700px) {
            .screen {
                justify-content: flex-start;
                padding-top: 40px;
                padding-bottom: 40px;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Elements -->
    <audio id="bg-music" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-game-show-suspense-waiting-667.mp3" type="audio/mpeg">
    </audio>
    <audio id="click-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
    </audio>
    <audio id="win-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="lose-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-sad-game-over-trombone-471.mp3" type="audio/mpeg">
    </audio>
    <audio id="draw-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-retro-game-over-213.mp3" type="audio/mpeg">
    </audio>
    <audio id="achievement-sound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>

    <!-- Particle Background -->
    <div class="particles" id="particles"></div>

    <!-- Notification System -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notification-title">Achievement Unlocked!</div>
        <div class="notification-message" id="notification-message">First Win - Win your first game</div>
    </div>

    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorial-overlay">
        <div class="tutorial-card">
            <div class="tutorial-title" id="tutorial-title">Welcome to Tic Tac Master!</div>
            <div class="tutorial-content" id="tutorial-content">
                This is a premium Tic Tac Toe experience with multiple game modes, AI opponents, and a progression system.
                Let's get started by entering your username!
            </div>
            <div class="tutorial-indicators">
                <div class="tutorial-indicator active"></div>
                <div class="tutorial-indicator"></div>
                <div class="tutorial-indicator"></div>
            </div>
            <button class="btn" id="tutorial-next">Next</button>
        </div>
    </div>

    <!-- Opening Animation Screen -->
    <div class="screen active" id="opening-screen">
        <div class="opening-container">
            <div class="board-animation">
                <div class="grid-line horizontal"></div>
                <div class="grid-line horizontal"></div>
                <div class="grid-line vertical"></div>
                <div class="grid-line vertical"></div>
            </div>
            <h1 class="title">Tic Tac Master</h1>
            <p class="subtitle">Made By Rutudev üòé</p>
        </div>
    </div>

    <!-- Username Entry Screen -->
    <div class="screen" id="username-screen">
        <div class="username-container">
            <div class="card">
                <h2>Enter Your Username</h2>
                <div class="input-group">
                    <label for="username">Username (no spaces or special characters)</label>
                    <input type="text" id="username" placeholder="Your username">
                    <div class="error-message" id="username-error">Invalid username. Only letters and numbers allowed.</div>
                </div>
                <button class="btn" id="username-submit">Continue</button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Screen -->
    <div class="screen" id="dashboard-screen">
        <button class="back-btn" id="dashboard-back" style="display: none;">‚Üê</button>
        <div class="dashboard-container">
            <div class="profile-section">
                <div class="avatar" id="user-avatar">U</div>
                <div class="profile-info">
                    <div class="username-display" id="dashboard-username">Username</div>
                    <div class="level-display">Level <span id="user-level">1</span></div>
                    <div class="xp-bar">
                        <div class="xp-progress" id="xp-progress"></div>
                    </div>
                    <div class="xp-text">XP: <span id="current-xp">0</span>/<span id="max-xp">100</span></div>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="wins-count">0</div>
                            <div class="stat-label">Wins</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="losses-count">0</div>
                            <div class="stat-label">Losses</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="draws-count">0</div>
                            <div class="stat-label">Draws</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="streak-count">0</div>
                            <div class="stat-label">Streak</div>
                        </div>
                    </div>
                </div>
                <button class="btn" id="edit-profile">Edit Profile</button>
            </div>

            <div class="menu-grid">
                <div class="menu-item" data-action="play">
                    <div class="menu-icon">üéÆ</div>
                    <div class="menu-title">Play</div>
                    <div class="menu-desc">Start a new game</div>
                </div>
                <div class="menu-item" data-screen="modes-screen">
                    <div class="menu-icon">üåà</div>
                    <div class="menu-title">Modes</div>
                    <div class="menu-desc">Choose game mode</div>
                </div>
                <div class="menu-item" data-screen="difficulty-screen">
                    <div class="menu-icon">ü§ñ</div>
                    <div class="menu-title">AI Difficulty</div>
                    <div class="menu-desc">Set AI strength</div>
                </div>
                <div class="menu-item" data-screen="leaderboard-screen">
                    <div class="menu-icon">üèÜ</div>
                    <div class="menu-title">Leaderboard</div>
                    <div class="menu-desc">Global rankings</div>
                </div>
                <div class="menu-item" data-screen="stats-screen">
                    <div class="menu-icon">üìä</div>
                    <div class="menu-title">Statistics</div>
                    <div class="menu-desc">View your stats</div>
                </div>
                <div class="menu-item" data-screen="achievements-screen">
                    <div class="menu-icon">üèÜ</div>
                    <div class="menu-title">Achievements</div>
                    <div class="menu-desc">Earn badges & rewards</div>
                </div>
                <div class="menu-item" data-screen="daily-rewards-screen">
                    <div class="menu-icon">üéÅ</div>
                    <div class="menu-title">Daily Rewards</div>
                    <div class="menu-desc">Claim your daily bonus</div>
                </div>
                <div class="menu-item" data-screen="themes-screen">
                    <div class="menu-icon">üé®</div>
                    <div class="menu-title">Themes</div>
                    <div class="menu-desc">Customize appearance</div>
                </div>
                <div class="menu-item" data-screen="settings-screen">
                    <div class="menu-icon">‚öôÔ∏è</div>
                    <div class="menu-title">Settings</div>
                    <div class="menu-desc">Customize your experience</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Modes Screen -->
    <div class="screen" id="modes-screen">
        <button class="back-btn" id="modes-back">‚Üê</button>
        <div class="modes-container">
            <h2>Game Modes</h2>
            <div class="modes-grid">
                <div class="mode-card" data-mode="classic">
                    <div class="mode-title">Classic 3x3</div>
                    <div class="mode-desc">The traditional Tic Tac Toe experience</div>
                    <div class="mode-xp">
                        <span>XP Reward:</span>
                        <span class="xp-value">Win: 20 | Draw: 10 | Loss: 5</span>
                    </div>
                </div>
                <div class="mode-card" data-mode="big-board">
                    <div class="mode-title">Big Board 5x5</div>
                    <div class="mode-desc">Larger board for extended gameplay</div>
                    <div class="mode-xp">
                        <span>XP Reward:</span>
                        <span class="xp-value">Win: 30 | Draw: 15 | Loss: 8</span>
                    </div>
                </div>
                <div class="mode-card featured" data-mode="impossible">
                    <div class="mode-badge">Challenge</div>
                    <div class="mode-title">Impossible Mode</div>
                    <div class="mode-desc">Face the ultimate AI challenge</div>
                    <div class="mode-xp">
                        <span>XP Reward:</span>
                        <span class="xp-value">Win: 100 | Draw: 30 | Loss: 10</span>
                    </div>
                </div>
                <div class="mode-card" data-mode="two-player">
                    <div class="mode-title">2-Player</div>
                    <div class="mode-desc">Play with a friend on the same device</div>
                    <div class="mode-xp">
                        <span>XP Reward:</span>
                        <span class="xp-value">Win: 15 | Draw: 8 | Loss: 0</span>
                    </div>
                </div>
                <div class="mode-card" data-mode="timed">
                    <div class="mode-title">Timed Mode</div>
                    <div class="mode-desc">Make your moves before time runs out</div>
                    <div class="mode-xp">
                        <span>XP Reward:</span>
                        <span class="xp-value">Win: 25 | Draw: 12 | Loss: 6</span>
                    </div>
                </div>
                <div class="mode-card" data-mode="xp-rush">
                    <div class="mode-title">XP Rush</div>
                    <div class="mode-desc">Earn bonus XP for quick victories</div>
                    <div class="mode-xp">
                        <span>XP Reward:</span>
                        <span class="xp-value">Win: 40 | Draw: 20 | Loss: 10</span>
                    </div>
                </div>
                <div class="mode-card" data-mode="tournament">
                    <div class="mode-title">Tournament</div>
                    <div class="mode-desc">Compete in a multi-round tournament</div>
                    <div class="mode-xp">
                        <span>XP Reward:</span>
                        <span class="xp-value">Win: 50 | Finalist: 30</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Difficulty Screen -->
    <div class="screen" id="difficulty-screen">
        <button class="back-btn" id="difficulty-back">‚Üê</button>
        <div class="difficulty-container">
            <h2>AI Difficulty</h2>
            <div class="difficulty-options">
                <div class="difficulty-option" data-difficulty="easy">
                    <div class="difficulty-icon" style="background: rgba(0, 184, 148, 0.3);">üòä</div>
                    <div class="difficulty-info">
                        <div class="difficulty-title">Easy</div>
                        <div class="difficulty-desc">AI makes random moves</div>
                    </div>
                </div>
                <div class="difficulty-option" data-difficulty="medium">
                    <div class="difficulty-icon" style="background: rgba(253, 203, 110, 0.3);">üòê</div>
                    <div class="difficulty-info">
                        <div class="difficulty-title">Medium</div>
                        <div class="difficulty-desc">AI uses basic strategy</div>
                    </div>
                </div>
                <div class="difficulty-option" data-difficulty="hard">
                    <div class="difficulty-icon" style="background: rgba(253, 121, 168, 0.3);">üòé</div>
                    <div class="difficulty-info">
                        <div class="difficulty-title">Hard (Rutu)</div>
                        <div class="difficulty-desc">Advanced AI with minimax algorithm</div>
                    </div>
                </div>
                <div class="difficulty-option" data-difficulty="impossible">
                    <div class="difficulty-icon" style="background: rgba(214, 48, 49, 0.3);">ü§Ø</div>
                    <div class="difficulty-info">
                        <div class="difficulty-title">Impossible</div>
                        <div class="difficulty-desc">Perfect play, cannot be beaten</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaderboard Screen -->
    <div class="screen" id="leaderboard-screen">
        <button class="back-btn" id="leaderboard-back">‚Üê</button>
        <div class="leaderboard-container">
            <h2>Global Leaderboard</h2>
            <div class="card">
                <div class="leaderboard-header">
                    <span>Rank</span>
                    <span>Player</span>
                    <span>Wins</span>
                </div>
                <div class="leaderboard-list" id="leaderboard-list">
                    <div class="loading-message">Loading leaderboard...</div>
                </div>
            </div>
            <button class="btn" id="refresh-leaderboard" style="margin-top: 20px;">Refresh</button>
        </div>
    </div>

    <!-- Versus Animation Screen -->
    <div class="screen" id="versus-screen">
        <div class="versus-container">
            <h2>Get Ready!</h2>
            <div class="versus-animation">
                <div class="player-card" id="player1-card">
                    <div class="player-name" id="player1-name">Player</div>
                    <div class="player-symbol">X</div>
                </div>
                <div class="vs-text">VS</div>
                <div class="energy-clash"></div>
                <div class="player-card" id="player2-card">
                    <div class="player-name" id="player2-name">AI</div>
                    <div class="player-symbol">O</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="screen" id="game-screen">
        <button class="back-btn" id="game-back">‚Üê</button>
        <div class="game-container">
            <div class="game-header">
                <div class="current-player" id="current-player">Player X's Turn</div>
                <div class="game-mode" id="game-mode">Classic 3x3</div>
                <div class="timer" id="game-timer">Time: 0:00</div>
            </div>
            <div class="game-board" id="game-board">
                <!-- Cells will be generated by JavaScript -->
            </div>
            <div class="game-controls">
                <button class="btn" id="restart-game">Restart</button>
                <button class="btn" id="main-menu">Main Menu</button>
            </div>
        </div>
    </div>

    <!-- Results Popup -->
    <div class="popup-overlay" id="results-popup">
        <div class="popup">
            <div class="popup-title" id="result-title">You Win!</div>
            <div class="popup-message" id="result-message">Congratulations on your victory!</div>
            <div class="popup-xp">
                <span class="xp-icon">‚≠ê</span>
                <span>+<span id="xp-earned">20</span> XP Earned</span>
            </div>
            <div class="popup-buttons">
                <button class="btn" id="play-again">Play Again</button>
                <button class="btn" id="back-to-dashboard">Dashboard</button>
            </div>
        </div>
    </div>

    <!-- Statistics Screen -->
    <div class="screen" id="stats-screen">
        <button class="back-btn" id="stats-back">‚Üê</button>
        <div class="stats-container">
            <h2>Your Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="total-games">0</div>
                    <div class="stat-label">Total Games</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="win-percentage">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="current-streak">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="best-streak">0</div>
                    <div class="stat-label">Best Streak</div>
                </div>
            </div>

            <div class="progress-container">
                <h3 style="margin-bottom: 20px;">Game Distribution</h3>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Wins</span>
                        <span id="wins-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="wins-progress" style="background: var(--success);"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Losses</span>
                        <span id="losses-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="losses-progress" style="background: var(--danger);"></div>
                    </div>
                </div>
                <div class="progress-item">
                    <div class="progress-label">
                        <span>Draws</span>
                        <span id="draws-percent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="draws-progress" style="background: var(--warning);"></div>
                    </div>
                </div>
            </div>

            <div class="card" style="margin-top: 30px;">
                <h3 style="margin-bottom: 15px;">Performance by Mode</h3>
                <div id="mode-stats">
                    <!-- Mode stats will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements Screen -->
    <div class="screen" id="achievements-screen">
        <button class="back-btn" id="achievements-back">‚Üê</button>
        <div class="achievements-container">
            <h2>Achievements</h2>
            <div class="achievements-grid" id="achievements-grid">
                <!-- Achievements will be generated here -->
            </div>
        </div>
    </div>

    <!-- Daily Rewards Screen -->
    <div class="screen" id="daily-rewards-screen">
        <button class="back-btn" id="daily-rewards-back">‚Üê</button>
        <div class="daily-rewards-container">
            <h2>Daily Rewards</h2>
            <div class="rewards-calendar" id="rewards-calendar">
                <!-- Daily rewards will be generated here -->
            </div>
            <div class="streak-info" id="streak-info">
                Current Streak: <span id="current-streak-display">0</span> days
            </div>
            <button class="btn" id="claim-reward" style="margin-top: 20px; width: 100%;">Claim Today's Reward</button>
        </div>
    </div>

    <!-- Themes Screen -->
    <div class="screen" id="themes-screen">
        <button class="back-btn" id="themes-back">‚Üê</button>
        <div class="themes-container">
            <h2>Themes</h2>
            <div class="themes-grid" id="themes-grid">
                <!-- Themes will be generated here -->
            </div>
        </div>
    </div>

    <!-- Settings Screen -->
    <div class="screen" id="settings-screen">
        <button class="back-btn" id="settings-back">‚Üê</button>
        <div class="settings-container">
            <h2>Settings</h2>
            <div class="card">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Sound Effects</div>
                        <div class="setting-desc">Enable or disable game sounds</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="sound-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Background Music</div>
                        <div class="setting-desc">Play background music during gameplay</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="music-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Animations</div>
                        <div class="setting-desc">Enable smooth animations and transitions</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="animations-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Vibration</div>
                        <div class="setting-desc">Haptic feedback on mobile devices</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="vibration-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Tutorial</div>
                        <div class="setting-desc">Show tutorial for new features</div>
                    </div>
                    <label class="toggle">
                        <input type="checkbox" id="tutorial-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="card" style="margin-top: 20px;">
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Reset Progress</div>
                        <div class="setting-desc">Clear all game data and start over</div>
                    </div>
                    <button class="btn" id="reset-progress" style="background: var(--danger);">Reset</button>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <div class="setting-title">Change Username</div>
                        <div class="setting-desc">Update your display name</div>
                    </div>
                    <button class="btn" id="change-username">Change</button>
                </div>
            </div>

            <div class="card" style="margin-top: 20px; text-align: center;">
                <h3>About Tic Tac Master</h3>
                <p style="margin: 15px 0; opacity: 0.8;">A premium Tic Tac Toe experience with multiple game modes, AI opponents, and progression system.</p>
                <p style="opacity: 0.7;">Version 2.0 | Made with ‚ù§Ô∏è by Rutudev</p>
            </div>
        </div>
    </div>

    <script>
        // Game State Management
        const gameState = {
            // User data
            username: '',
            level: 1,
            xp: 0,
            xpToNextLevel: 100,
            wins: 0,
            losses: 0,
            draws: 0,
            currentStreak: 0,
            bestStreak: 0,
            
            // Game settings
            soundEnabled: true,
            musicEnabled: false,
            animationsEnabled: true,
            vibrationEnabled: false,
            tutorialEnabled: true,
            currentTheme: 'default',
            
            // Current game state
            currentMode: 'classic',
            currentDifficulty: 'medium',
            gameBoard: ['', '', '', '', '', '', '', '', ''],
            currentPlayer: 'X',
            gameActive: true,
            vsPlayer: false,
            playerSymbol: 'X',
            aiSymbol: 'O',
            aiName: 'AI',
            gameResult: null,
            
            // Firebase
            firebase: {
                db: null,
                initialized: false
            },
            
            // Achievement system
            achievements: [
                {
                    id: 'first_win',
                    name: 'First Win',
                    description: 'Win your first game',
                    icon: 'üèÜ',
                    xpReward: 50,
                    achieved: false,
                    progress: 0,
                    target: 1
                },
                {
                    id: 'five_wins',
                    name: 'Victorious',
                    description: 'Win 5 games',
                    icon: '‚≠ê',
                    xpReward: 100,
                    achieved: false,
                    progress: 0,
                    target: 5
                },
                {
                    id: 'ten_wins',
                    name: 'Tic Tac Master',
                    description: 'Win 10 games',
                    icon: 'üëë',
                    xpReward: 200,
                    achieved: false,
                    progress: 0,
                    target: 10
                },
                {
                    id: 'beat_rutu',
                    name: 'Rutu Conqueror',
                    description: 'Beat Rutu on Hard difficulty',
                    icon: 'üòé',
                    xpReward: 300,
                    achieved: false,
                    progress: 0,
                    target: 1
                },
                {
                    id: 'streak_5',
                    name: 'Hot Streak',
                    description: 'Achieve a 5-game win streak',
                    icon: 'üî•',
                    xpReward: 150,
                    achieved: false,
                    progress: 0,
                    target: 5
                },
                {
                    id: 'level_10',
                    name: 'Decade',
                    description: 'Reach level 10',
                    icon: 'üîü',
                    xpReward: 500,
                    achieved: false,
                    progress: 1,
                    target: 10
                },
                {
                    id: 'perfect_game',
                    name: 'Flawless Victory',
                    description: 'Win without the opponent making a move',
                    icon: 'üíé',
                    xpReward: 250,
                    achieved: false,
                    progress: 0,
                    target: 1
                },
                {
                    id: 'draw_master',
                    name: 'Peacekeeper',
                    description: 'Play 10 draw games',
                    icon: 'ü§ù',
                    xpReward: 100,
                    achieved: false,
                    progress: 0,
                    target: 10
                }
            ],
            
            // Daily rewards system
            dailyRewards: [
                { day: 1, xp: 10 },
                { day: 2, xp: 20 },
                { day: 3, xp: 30 },
                { day: 4, xp: 40 },
                { day: 5, xp: 50 },
                { day: 6, xp: 75 },
                { day: 7, xp: 100 }
            ],
            lastLoginDate: null,
            currentStreak: 0,
            claimedRewards: [],
            
            // Statistics by mode
            modeStats: {
                classic: { wins: 0, losses: 0, draws: 0 },
                'big-board': { wins: 0, losses: 0, draws: 0 },
                impossible: { wins: 0, losses: 0, draws: 0 },
                'two-player': { wins: 0, losses: 0, draws: 0 },
                timed: { wins: 0, losses: 0, draws: 0 },
                'xp-rush': { wins: 0, losses: 0, draws: 0 },
                tournament: { wins: 0, losses: 0, draws: 0 }
            },
            
            // Tournament state
            tournament: {
                active: false,
                round: 1,
                matches: [],
                players: [],
                winner: null
            },
            
            // Initialize from localStorage
            init() {
                this.loadFromStorage();
                this.initFirebase();
                this.updateUI();
                this.checkDailyReward();
                this.applyTheme();
                
                // Show tutorial if enabled and first time
                if (this.tutorialEnabled && !this.username) {
                    setTimeout(() => {
                        this.showTutorial();
                    }, 500);
                }
            },
            
            // Initialize Firebase
            initFirebase() {
                if (window.firebaseDb) {
                    this.firebase.db = window.firebaseDb;
                    this.firebase.initialized = true;
                    console.log('Firebase initialized successfully');
                } else {
                    console.error('Firebase not available');
                }
            },
            
            // Save score to Firebase leaderboard
            saveScore(username, score) {
                if (!this.firebase.initialized) {
                    console.error('Firebase not initialized');
                    return;
                }

                try {
                    const db = this.firebase.db;
                    const leaderboardRef = window.firebaseRef(db, "leaderboard/" + username);
                    
                    window.firebaseSet(leaderboardRef, {
                        name: username,
                        score: score,
                        lastUpdated: new Date().toISOString()
                    }).then(() => {
                        console.log('Score saved to leaderboard:', username, score);
                    }).catch((error) => {
                        console.error('Error saving score:', error);
                    });
                } catch (error) {
                    console.error('Firebase error:', error);
                }
            },
            
            // Load leaderboard from Firebase
            loadLeaderboard(callback) {
                if (!this.firebase.initialized) {
                    console.error('Firebase not initialized');
                    if (callback) callback([]);
                    return;
                }

                try {
                    const db = this.firebase.db;
                    const leaderboardRef = window.firebaseRef(db, "leaderboard");
                    
                    window.firebaseOnValue(leaderboardRef, (snapshot) => {
                        const data = snapshot.val();
                        const leaderboard = [];
                        
                        if (data) {
                            for (const username in data) {
                                leaderboard.push({
                                    username: username,
                                    name: data[username].name,
                                    score: data[username].score || 0
                                });
                            }
                            
                            // Sort by score descending
                            leaderboard.sort((a, b) => b.score - a.score);
                        }
                        
                        if (callback) callback(leaderboard);
                    }, (error) => {
                        console.error('Error loading leaderboard:', error);
                        if (callback) callback([]);
                    });
                } catch (error) {
                    console.error('Firebase error:', error);
                    if (callback) callback([]);
                }
            },
            
            // Save to localStorage
            saveToStorage() {
                const data = {
                    username: this.username,
                    level: this.level,
                    xp: this.xp,
                    wins: this.wins,
                    losses: this.losses,
                    draws: this.draws,
                    currentStreak: this.currentStreak,
                    bestStreak: this.bestStreak,
                    soundEnabled: this.soundEnabled,
                    musicEnabled: this.musicEnabled,
                    animationsEnabled: this.animationsEnabled,
                    vibrationEnabled: this.vibrationEnabled,
                    tutorialEnabled: this.tutorialEnabled,
                    currentTheme: this.currentTheme,
                    currentMode: this.currentMode,
                    currentDifficulty: this.currentDifficulty,
                    achievements: this.achievements,
                    lastLoginDate: this.lastLoginDate,
                    dailyStreak: this.currentStreak,
                    claimedRewards: this.claimedRewards,
                    modeStats: this.modeStats
                };
                localStorage.setItem('ticTacMasterData', JSON.stringify(data));
            },
            
            // Load from localStorage
            loadFromStorage() {
                const data = JSON.parse(localStorage.getItem('ticTacMasterData'));
                if (data) {
                    this.username = data.username || '';
                    this.level = data.level || 1;
                    this.xp = data.xp || 0;
                    this.wins = data.wins || 0;
                    this.losses = data.losses || 0;
                    this.draws = data.draws || 0;
                    this.currentStreak = data.currentStreak || 0;
                    this.bestStreak = data.bestStreak || 0;
                    this.soundEnabled = data.soundEnabled !== undefined ? data.soundEnabled : true;
                    this.musicEnabled = data.musicEnabled || false;
                    this.animationsEnabled = data.animationsEnabled !== undefined ? data.animationsEnabled : true;
                    this.vibrationEnabled = data.vibrationEnabled || false;
                    this.tutorialEnabled = data.tutorialEnabled !== undefined ? data.tutorialEnabled : true;
                    this.currentTheme = data.currentTheme || 'default';
                    this.currentMode = data.currentMode || 'classic';
                    this.currentDifficulty = data.currentDifficulty || 'medium';
                    this.achievements = data.achievements || this.achievements;
                    this.lastLoginDate = data.lastLoginDate || null;
                    this.currentStreak = data.dailyStreak || 0;
                    this.claimedRewards = data.claimedRewards || [];
                    this.modeStats = data.modeStats || this.modeStats;
                }
                
                // Calculate XP to next level
                this.xpToNextLevel = this.level * 100;
            },
            
            // Update all UI elements with current state
            updateUI() {
                // Update dashboard
                if (this.username) {
                    document.getElementById('dashboard-username').textContent = this.username;
                    document.getElementById('user-avatar').textContent = this.username.charAt(0).toUpperCase();
                }
                
                document.getElementById('user-level').textContent = this.level;
                document.getElementById('current-xp').textContent = this.xp;
                document.getElementById('max-xp').textContent = this.xpToNextLevel;
                
                const xpPercent = Math.min(100, (this.xp / this.xpToNextLevel) * 100);
                document.getElementById('xp-progress').style.width = `${xpPercent}%`;
                
                document.getElementById('wins-count').textContent = this.wins;
                document.getElementById('losses-count').textContent = this.losses;
                document.getElementById('draws-count').textContent = this.draws;
                document.getElementById('streak-count').textContent = this.currentStreak;
                
                // Update stats screen
                const totalGames = this.wins + this.losses + this.draws;
                document.getElementById('total-games').textContent = totalGames;
                
                const winPercentage = totalGames > 0 ? Math.round((this.wins / totalGames) * 100) : 0;
                document.getElementById('win-percentage').textContent = `${winPercentage}%`;
                
                document.getElementById('current-streak').textContent = this.currentStreak;
                document.getElementById('best-streak').textContent = this.bestStreak;
                
                // Update progress bars
                const winsPercent = totalGames > 0 ? (this.wins / totalGames) * 100 : 0;
                const lossesPercent = totalGames > 0 ? (this.losses / totalGames) * 100 : 0;
                const drawsPercent = totalGames > 0 ? (this.draws / totalGames) * 100 : 0;
                
                document.getElementById('wins-progress').style.width = `${winsPercent}%`;
                document.getElementById('losses-progress').style.width = `${lossesPercent}%`;
                document.getElementById('draws-progress').style.width = `${drawsPercent}%`;
                
                document.getElementById('wins-percent').textContent = `${Math.round(winsPercent)}%`;
                document.getElementById('losses-percent').textContent = `${Math.round(lossesPercent)}%`;
                document.getElementById('draws-percent').textContent = `${Math.round(drawsPercent)}%`;
                
                // Update mode stats
                this.updateModeStats();
                
                // Update settings toggles
                document.getElementById('sound-toggle').checked = this.soundEnabled;
                document.getElementById('music-toggle').checked = this.musicEnabled;
                document.getElementById('animations-toggle').checked = this.animationsEnabled;
                document.getElementById('vibration-toggle').checked = this.vibrationEnabled;
                document.getElementById('tutorial-toggle').checked = this.tutorialEnabled;
                
                // Update achievements
                this.updateAchievementsUI();
                
                // Update daily rewards
                this.updateDailyRewardsUI();
                
                // Update themes
                this.updateThemesUI();
                
                // Update audio based on settings
                this.updateAudio();
            },
            
            // Update mode statistics display
            updateModeStats() {
                const modeStatsElement = document.getElementById('mode-stats');
                if (!modeStatsElement) return;
                
                let html = '';
                for (const mode in this.modeStats) {
                    const stats = this.modeStats[mode];
                    const total = stats.wins + stats.losses + stats.draws;
                    if (total === 0) continue;
                    
                    const winRate = Math.round((stats.wins / total) * 100);
                    
                    html += `
                        <div class="progress-item">
                            <div class="progress-label">
                                <span>${this.getModeName(mode)}</span>
                                <span>${winRate}% (${stats.wins}/${total})</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${winRate}%; background: var(--primary);"></div>
                            </div>
                        </div>
                    `;
                }
                
                modeStatsElement.innerHTML = html || '<p style="text-align: center; opacity: 0.7;">No mode statistics yet</p>';
            },
            
            // Get display name for game mode
            getModeName(mode) {
                const modeNames = {
                    'classic': 'Classic 3x3',
                    'big-board': 'Big Board 5x5',
                    'impossible': 'Impossible',
                    'two-player': '2-Player',
                    'timed': 'Timed',
                    'xp-rush': 'XP Rush',
                    'tournament': 'Tournament'
                };
                return modeNames[mode] || mode;
            },
            
            // Update achievements UI
            updateAchievementsUI() {
                const achievementsGrid = document.getElementById('achievements-grid');
                if (!achievementsGrid) return;
                
                let html = '';
                this.achievements.forEach(achievement => {
                    const progressPercent = (achievement.progress / achievement.target) * 100;
                    html += `
                        <div class="achievement-card ${achievement.achieved ? '' : 'locked'}">
                            <div class="achievement-icon">${achievement.icon}</div>
                            <div class="achievement-title">${achievement.name}</div>
                            <div class="achievement-desc">${achievement.description}</div>
                            ${!achievement.achieved ? `
                                <div class="achievement-progress">
                                    <div class="achievement-progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                                <div class="achievement-progress-text">${achievement.progress}/${achievement.target}</div>
                            ` : `
                                <div class="achievement-badge">${achievement.xpReward} XP</div>
                            `}
                        </div>
                    `;
                });
                
                achievementsGrid.innerHTML = html;
            },
            
            // Update daily rewards UI
            updateDailyRewardsUI() {
                const rewardsCalendar = document.getElementById('rewards-calendar');
                const streakInfo = document.getElementById('streak-info');
                const claimButton = document.getElementById('claim-reward');
                
                if (!rewardsCalendar) return;
                
                // Calculate today's date and check if reward is available
                const today = new Date().toDateString();
                const lastClaim = this.lastLoginDate ? new Date(this.lastLoginDate).toDateString() : null;
                const canClaim = lastClaim !== today;
                
                let html = '';
                this.dailyRewards.forEach((reward, index) => {
                    const day = index + 1;
                    let className = 'reward-day';
                    
                    if (this.claimedRewards.includes(day)) {
                        className += ' claimed';
                    } else if (canClaim && day === this.currentStreak + 1) {
                        className += ' available';
                    } else if (day > this.currentStreak + 1) {
                        className += ' future';
                    }
                    
                    html += `
                        <div class="${className}" data-day="${day}">
                            <div class="reward-xp">+${reward.xp}</div>
                            <div class="reward-day-label">Day ${day}</div>
                        </div>
                    `;
                });
                
                rewardsCalendar.innerHTML = html;
                streakInfo.innerHTML = `Current Streak: <span id="current-streak-display">${this.currentStreak}</span> days`;
                
                // Update claim button
                if (claimButton) {
                    claimButton.textContent = canClaim ? "Claim Today's Reward" : "Already Claimed Today";
                    claimButton.disabled = !canClaim;
                }
            },
            
            // Update themes UI
            updateThemesUI() {
                const themesGrid = document.getElementById('themes-grid');
                if (!themesGrid) return;
                
                const themes = [
                    { id: 'default', name: 'Default', gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                    { id: 'dark', name: 'Dark', gradient: 'linear-gradient(135deg, #2d3436 0%, #636e72 100%)' },
                    { id: 'neon', name: 'Neon', gradient: 'linear-gradient(135deg, #0984e3 0%, #00cec9 100%)' },
                    { id: 'pastel', name: 'Pastel', gradient: 'linear-gradient(135deg, #fd79a8 0%, #a29bfe 100%)' }
                ];
                
                let html = '';
                themes.forEach(theme => {
                    html += `
                        <div class="theme-card ${this.currentTheme === theme.id ? 'active' : ''}" data-theme="${theme.id}">
                            <div class="theme-preview" style="background: ${theme.gradient};"></div>
                            <div class="theme-name">${theme.name}</div>
                        </div>
                    `;
                });
                
                themesGrid.innerHTML = html;
            },
            
            // Apply selected theme
            applyTheme() {
                document.body.className = this.currentTheme !== 'default' ? `theme-${this.currentTheme}` : '';
            },
            
            // Check and claim daily reward
            checkDailyReward() {
                const today = new Date().toDateString();
                const lastClaim = this.lastLoginDate ? new Date(this.lastLoginDate).toDateString() : null;
                
                // If already claimed today, do nothing
                if (lastClaim === today) return;
                
                // If last claim was yesterday, increment streak
                if (lastClaim && this.isYesterday(new Date(lastClaim))) {
                    this.currentStreak++;
                } else if (!lastClaim || !this.isConsecutiveDay(new Date(lastClaim))) {
                    // Reset streak if not consecutive
                    this.currentStreak = 0;
                }
                
                // Show notification if reward is available
                if (lastClaim !== today) {
                    setTimeout(() => {
                        this.showNotification('Daily Reward Available!', 'Claim your daily XP bonus in the Daily Rewards section.');
                    }, 1000);
                }
            },
            
            // Claim daily reward
            claimDailyReward() {
                const today = new Date().toDateString();
                const lastClaim = this.lastLoginDate ? new Date(this.lastLoginDate).toDateString() : null;
                
                if (lastClaim === today) {
                    this.showNotification('Already Claimed', 'You have already claimed your daily reward today.');
                    return;
                }
                
                const rewardDay = this.currentStreak + 1;
                const reward = this.dailyRewards[rewardDay - 1];
                
                if (reward) {
                    this.addXP(reward.xp);
                    this.claimedRewards.push(rewardDay);
                    this.lastLoginDate = new Date().toISOString();
                    this.currentStreak = rewardDay;
                    
                    this.saveToStorage();
                    this.updateDailyRewardsUI();
                    
                    this.showNotification('Daily Reward Claimed!', `You received +${reward.xp} XP!`);
                    
                    // Play achievement sound
                    if (this.soundEnabled) {
                        document.getElementById('achievement-sound').play().catch(e => console.log('Audio play failed:', e));
                    }
                }
            },
            
            // Helper function to check if a date is yesterday
            isYesterday(date) {
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                return date.toDateString() === yesterday.toDateString();
            },
            
            // Helper function to check if a date is consecutive (within 1 day)
            isConsecutiveDay(date) {
                const today = new Date();
                const diffTime = Math.abs(today - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays <= 1;
            },
            
            // Show notification
            showNotification(title, message) {
                const notification = document.getElementById('notification');
                const notificationTitle = document.getElementById('notification-title');
                const notificationMessage = document.getElementById('notification-message');
                
                notificationTitle.textContent = title;
                notificationMessage.textContent = message;
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            },
            
            // Show tutorial
            showTutorial() {
                const tutorialOverlay = document.getElementById('tutorial-overlay');
                tutorialOverlay.classList.add('active');
            },
            
            // Update audio based on settings
            updateAudio() {
                const bgMusic = document.getElementById('bg-music');
                
                if (this.musicEnabled) {
                    bgMusic.volume = 0.5;
                    bgMusic.play().catch(e => console.log('Music play failed:', e));
                } else {
                    bgMusic.pause();
                }
            },
            
            // Play sound effect
            playSound(soundId) {
                if (!this.soundEnabled) return;
                
                const sound = document.getElementById(soundId);
                if (sound) {
                    sound.currentTime = 0;
                    sound.play().catch(e => console.log('Sound play failed:', e));
                }
            },
            
            // Check and update achievements
            checkAchievements() {
                let newAchievements = [];
                
                this.achievements.forEach(achievement => {
                    if (achievement.achieved) return;
                    
                    let progressUpdated = false;
                    
                    switch (achievement.id) {
                        case 'first_win':
                            if (this.wins >= 1) {
                                achievement.progress = 1;
                                progressUpdated = true;
                            }
                            break;
                        case 'five_wins':
                            if (this.wins >= 5) {
                                achievement.progress = this.wins;
                                progressUpdated = true;
                            }
                            break;
                        case 'ten_wins':
                            if (this.wins >= 10) {
                                achievement.progress = this.wins;
                                progressUpdated = true;
                            }
                            break;
                        case 'beat_rutu':
                            // This would be set when winning against Rutu on hard difficulty
                            break;
                        case 'streak_5':
                            if (this.currentStreak >= 5) {
                                achievement.progress = this.currentStreak;
                                progressUpdated = true;
                            }
                            break;
                        case 'level_10':
                            if (this.level >= 10) {
                                achievement.progress = this.level;
                                progressUpdated = true;
                            }
                            break;
                        case 'perfect_game':
                            // This would be set when winning without opponent making a move
                            break;
                        case 'draw_master':
                            if (this.draws >= 10) {
                                achievement.progress = this.draws;
                                progressUpdated = true;
                            }
                            break;
                    }
                    
                    if (progressUpdated && achievement.progress >= achievement.target) {
                        achievement.achieved = true;
                        newAchievements.push(achievement);
                    }
                });
                
                // Award new achievements
                newAchievements.forEach(achievement => {
                    this.addXP(achievement.xpReward);
                    this.showNotification('Achievement Unlocked!', `${achievement.name} - ${achievement.xpReward} XP`);
                    this.playSound('achievement-sound');
                });
                
                if (newAchievements.length > 0) {
                    this.saveToStorage();
                    this.updateAchievementsUI();
                }
            },
            
            // Add XP and check for level up
            addXP(amount) {
                this.xp += amount;
                
                // Check for level up
                if (this.xp >= this.xpToNextLevel) {
                    this.level++;
                    this.xp = this.xp - this.xpToNextLevel;
                    this.xpToNextLevel = this.level * 100;
                    
                    // Show level up notification
                    this.showNotification('Level Up!', `You reached level ${this.level}!`);
                    
                    // Play achievement sound
                    if (this.soundEnabled) {
                        document.getElementById('achievement-sound').play().catch(e => console.log('Audio play failed:', e));
                    }
                }
                
                this.saveToStorage();
                this.updateUI();
            },
            
            // Record game result
            recordResult(result, mode) {
                if (result === 'win') {
                    this.wins++;
                    this.currentStreak++;
                    if (this.currentStreak > this.bestStreak) {
                        this.bestStreak = this.currentStreak;
                    }
                    
                    // Save to Firebase leaderboard when player wins
                    if (this.username && this.firebase.initialized) {
                        this.saveScore(this.username, this.wins);
                    }
                } else if (result === 'loss') {
                    this.losses++;
                    this.currentStreak = 0;
                } else if (result === 'draw') {
                    this.draws++;
                    this.currentStreak = 0;
                }
                
                // Update mode statistics
                if (mode && this.modeStats[mode]) {
                    if (result === 'win') this.modeStats[mode].wins++;
                    else if (result === 'loss') this.modeStats[mode].losses++;
                    else if (result === 'draw') this.modeStats[mode].draws++;
                }
                
                // Check achievements
                this.checkAchievements();
                
                this.saveToStorage();
                this.updateUI();
            },
            
            // Reset all progress
            resetProgress() {
                this.level = 1;
                this.xp = 0;
                this.xpToNextLevel = 100;
                this.wins = 0;
                this.losses = 0;
                this.draws = 0;
                this.currentStreak = 0;
                this.bestStreak = 0;
                this.currentStreak = 0;
                this.claimedRewards = [];
                this.lastLoginDate = null;
                
                // Reset achievements
                this.achievements.forEach(achievement => {
                    achievement.achieved = false;
                    achievement.progress = 0;
                });
                
                // Reset mode stats
                for (const mode in this.modeStats) {
                    this.modeStats[mode] = { wins: 0, losses: 0, draws: 0 };
                }
                
                this.saveToStorage();
                this.updateUI();
            },
            
            // Reset current game board
            resetGame() {
                this.gameBoard = ['', '', '', '', '', '', '', '', ''];
                this.currentPlayer = 'X';
                this.gameActive = true;
                this.gameResult = null;
            }
        };

        // Screen Management
        const screenManager = {
            currentScreen: 'opening-screen',
            
            init() {
                // Set up screen transitions
                this.setupScreenTransitions();
                
                // Check if we should skip opening animation
                if (gameState.username) {
                    this.showScreen('dashboard-screen');
                } else {
                    // Start with opening animation
                    setTimeout(() => {
                        this.showScreen('username-screen');
                    }, 4000);
                }
            },
            
            setupScreenTransitions() {
                // Back buttons
                document.querySelectorAll('.back-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.showScreen('dashboard-screen');
                    });
                });
                
                // Menu items
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const targetScreen = item.getAttribute('data-screen');
                        const action = item.getAttribute('data-action');
                        
                        if (action === 'play') {
                            // Start a game with current settings
                            gameState.currentMode = 'classic'; // Default to classic
                            this.showVersusScreen();
                        } else if (targetScreen) {
                            this.showScreen(targetScreen);
                        }
                    });
                });
                
                // Mode selection
                document.querySelectorAll('.mode-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const mode = card.getAttribute('data-mode');
                        gameState.currentMode = mode;
                        gameState.saveToStorage();
                        
                        // Show versus animation for AI modes
                        if (mode !== 'two-player' && mode !== 'tournament') {
                            this.showVersusScreen();
                        } else if (mode === 'tournament') {
                            this.startTournament();
                        } else {
                            // For two-player mode, go directly to game
                            this.startGame();
                        }
                    });
                });
                
                // Difficulty selection
                document.querySelectorAll('.difficulty-option').forEach(option => {
                    option.addEventListener('click', () => {
                        const difficulty = option.getAttribute('data-difficulty');
                        gameState.currentDifficulty = difficulty;
                        
                        // Set AI name for hard difficulty
                        if (difficulty === 'hard') {
                            gameState.aiName = 'Rutu';
                        } else {
                            gameState.aiName = 'AI';
                        }
                        
                        gameState.saveToStorage();
                        this.showScreen('dashboard-screen');
                    });
                });
                
                // Theme selection
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.theme-card')) {
                        const themeCard = e.target.closest('.theme-card');
                        const theme = themeCard.getAttribute('data-theme');
                        gameState.currentTheme = theme;
                        gameState.applyTheme();
                        gameState.saveToStorage();
                        gameState.updateThemesUI();
                    }
                });
                
                // Daily reward claim
                document.addEventListener('click', (e) => {
                    if (e.target.id === 'claim-reward') {
                        gameState.claimDailyReward();
                    }
                });
                
                // Leaderboard refresh
                document.getElementById('refresh-leaderboard').addEventListener('click', () => {
                    this.updateLeaderboard();
                });
                
                // Tutorial
                document.getElementById('tutorial-next').addEventListener('click', () => {
                    document.getElementById('tutorial-overlay').classList.remove('active');
                });
            },
            
            showScreen(screenId) {
                // Hide current screen
                document.getElementById(this.currentScreen).classList.remove('active');
                
                // Show new screen
                document.getElementById(screenId).classList.add('active');
                this.currentScreen = screenId;
                
                // Update UI when showing dashboard or stats
                if (screenId === 'dashboard-screen' || screenId === 'stats-screen') {
                    gameState.updateUI();
                }
                
                // Load leaderboard when showing leaderboard screen
                if (screenId === 'leaderboard-screen') {
                    this.updateLeaderboard();
                }
                
                // Special handling for game screen
                if (screenId === 'game-screen') {
                    gameManager.initGame();
                }
            },
            
            updateLeaderboard() {
                const leaderboardList = document.getElementById('leaderboard-list');
                leaderboardList.innerHTML = '<div class="loading-message">Loading leaderboard...</div>';
                
                gameState.loadLeaderboard((leaderboard) => {
                    if (leaderboard.length === 0) {
                        leaderboardList.innerHTML = '<div class="error-message">No leaderboard data found</div>';
                        return;
                    }
                    
                    let html = '';
                    leaderboard.forEach((player, index) => {
                        const rank = index + 1;
                        const isCurrentUser = player.username === gameState.username;
                        const rankClass = rank <= 3 ? `rank-${rank}` : '';
                        const userClass = isCurrentUser ? 'current-user' : '';
                        
                        html += `
                            <div class="leaderboard-item ${rankClass} ${userClass}">
                                <div class="leaderboard-rank">#${rank}</div>
                                <div class="leaderboard-name">${player.name}</div>
                                <div class="leaderboard-score">${player.score} wins</div>
                            </div>
                        `;
                    });
                    
                    leaderboardList.innerHTML = html;
                });
            },
            
            showVersusScreen() {
                this.showScreen('versus-screen');
                
                // Set player names
                document.getElementById('player1-name').textContent = gameState.username;
                document.getElementById('player2-name').textContent = gameState.aiName;
                
                // Animate versus elements
                const player1Card = document.getElementById('player1-card');
                const player2Card = document.getElementById('player2-card');
                const vsText = document.querySelector('.vs-text');
                const energyClash = document.querySelector('.energy-clash');
                
                setTimeout(() => {
                    player1Card.style.opacity = '1';
                    player1Card.style.transform = 'translateY(0)';
                }, 300);
                
                setTimeout(() => {
                    vsText.style.opacity = '1';
                }, 800);
                
                setTimeout(() => {
                    player2Card.style.opacity = '1';
                    player2Card.style.transform = 'translateY(0)';
                }, 1300);
                
                setTimeout(() => {
                    energyClash.style.opacity = '0.7';
                }, 1800);
                
                // After animation, start the game
                setTimeout(() => {
                    this.startGame();
                }, 3500);
            },
            
            startGame() {
                this.showScreen('game-screen');
            },
            
            startTournament() {
                // Initialize tournament state
                gameState.tournament = {
                    active: true,
                    round: 1,
                    matches: [
                        { player1: gameState.username, player2: 'AI Easy', winner: null },
                        { player1: 'AI Medium', player2: 'AI Hard', winner: null }
                    ],
                    players: [gameState.username, 'AI Easy', 'AI Medium', 'AI Hard'],
                    winner: null
                };
                
                // For now, just start a regular game
                this.showVersusScreen();
            },
            
            showResults(result, xpEarned) {
                const popup = document.getElementById('results-popup');
                const title = document.getElementById('result-title');
                const message = document.getElementById('result-message');
                const xpEarnedElement = document.getElementById('xp-earned');
                
                // Set result content
                if (result === 'win') {
                    title.textContent = 'You Win!';
                    message.textContent = 'Congratulations on your victory!';
                    gameState.playSound('win-sound');
                } else if (result === 'loss') {
                    title.textContent = 'You Lose!';
                    message.textContent = 'Better luck next time!';
                    gameState.playSound('lose-sound');
                } else {
                    title.textContent = "It's a Draw!";
                    message.textContent = 'The game ended in a tie.';
                    gameState.playSound('draw-sound');
                }
                
                xpEarnedElement.textContent = xpEarned;
                
                // Show popup
                popup.classList.add('active');
                
                // Set up popup buttons
                document.getElementById('play-again').onclick = () => {
                    popup.classList.remove('active');
                    gameManager.initGame();
                };
                
                document.getElementById('back-to-dashboard').onclick = () => {
                    popup.classList.remove('active');
                    this.showScreen('dashboard-screen');
                };
            }
        };

        // Game Manager
        const gameManager = {
            timer: null,
            timeElapsed: 0,
            
            initGame() {
                // Reset game state
                gameState.resetGame();
                
                // Set up game mode
                this.setupGameMode();
                
                // Create game board
                this.createBoard();
                
                // Update UI
                this.updateGameUI();
                
                // Start timer for timed mode
                if (gameState.currentMode === 'timed') {
                    this.startTimer();
                }
                
                // If playing against AI and AI goes first
                if (!gameState.vsPlayer && Math.random() > 0.5) {
                    gameState.currentPlayer = 'O';
                    this.updateGameUI();
                    
                    setTimeout(() => {
                        this.makeAIMove();
                    }, 500);
                }
            },
            
            setupGameMode() {
                const modeElement = document.getElementById('game-mode');
                const vsPlayer = gameState.currentMode === 'two-player';
                
                gameState.vsPlayer = vsPlayer;
                
                // Set player symbols
                if (vsPlayer) {
                    gameState.playerSymbol = 'X';
                    gameState.aiSymbol = 'O';
                    modeElement.textContent = '2-Player Mode';
                } else {
                    gameState.playerSymbol = 'X';
                    gameState.aiSymbol = 'O';
                    
                    // Set mode name
                    const modeNames = {
                        'classic': 'Classic 3x3',
                        'big-board': 'Big Board 5x5',
                        'impossible': 'Impossible Mode',
                        'timed': 'Timed Mode',
                        'xp-rush': 'XP Rush',
                        'tournament': 'Tournament Mode'
                    };
                    
                    modeElement.textContent = modeNames[gameState.currentMode] || 'Classic 3x3';
                }
            },
            
            createBoard() {
                const boardElement = document.getElementById('game-board');
                boardElement.innerHTML = '';
                
                // Create 3x3 grid
                for (let i = 0; i < 9; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.setAttribute('data-index', i);
                    cell.addEventListener('click', () => this.cellClicked(i));
                    boardElement.appendChild(cell);
                }
            },
            
            updateGameUI() {
                const currentPlayerElement = document.getElementById('current-player');
                
                if (gameState.currentPlayer === 'X') {
                    currentPlayerElement.textContent = gameState.vsPlayer ? 
                        "Player X's Turn" : "Your Turn (X)";
                } else {
                    currentPlayerElement.textContent = gameState.vsPlayer ? 
                        "Player O's Turn" : "AI's Turn (O)";
                }
                
                // Update board display
                const cells = document.querySelectorAll('.cell');
                cells.forEach((cell, index) => {
                    cell.textContent = gameState.gameBoard[index];
                    cell.className = 'cell';
                    
                    if (gameState.gameBoard[index] === 'X') {
                        cell.classList.add('x');
                    } else if (gameState.gameBoard[index] === 'O') {
                        cell.classList.add('o');
                    }
                });
            },
            
            startTimer() {
                this.timeElapsed = 0;
                const timerElement = document.getElementById('game-timer');
                
                if (this.timer) {
                    clearInterval(this.timer);
                }
                
                this.timer = setInterval(() => {
                    this.timeElapsed++;
                    const minutes = Math.floor(this.timeElapsed / 60);
                    const seconds = this.timeElapsed % 60;
                    timerElement.textContent = `Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            },
            
            stopTimer() {
                if (this.timer) {
                    clearInterval(this.timer);
                    this.timer = null;
                }
            },
            
            cellClicked(index) {
                // Check if game is active and cell is empty
                if (!gameState.gameActive || gameState.gameBoard[index] !== '') {
                    return;
                }
                
                // Check if it's player's turn
                if (!gameState.vsPlayer && gameState.currentPlayer !== gameState.playerSymbol) {
                    return;
                }
                
                // Play click sound
                gameState.playSound('click-sound');
                
                // Make move
                this.makeMove(index);
                
                // Check for game result
                const result = this.checkGameResult();
                
                if (result) {
                    this.handleGameResult(result);
                } else if (!gameState.vsPlayer && gameState.gameActive) {
                    // AI's turn
                    gameState.currentPlayer = gameState.aiSymbol;
                    this.updateGameUI();
                    
                    setTimeout(() => {
                        this.makeAIMove();
                    }, 500);
                }
            },
            
            makeMove(index) {
                gameState.gameBoard[index] = gameState.currentPlayer;
                this.updateGameUI();
                
                // Switch player
                gameState.currentPlayer = gameState.currentPlayer === 'X' ? 'O' : 'X';
            },
            
            makeAIMove() {
                if (!gameState.gameActive) return;
                
                let moveIndex;
                
                // AI logic based on difficulty
                switch (gameState.currentDifficulty) {
                    case 'easy':
                        moveIndex = this.getRandomMove();
                        break;
                    case 'medium':
                        moveIndex = this.getMediumAIMove();
                        break;
                    case 'hard':
                    case 'impossible':
                        moveIndex = this.getBestMove();
                        break;
                    default:
                        moveIndex = this.getRandomMove();
                }
                
                if (moveIndex !== -1) {
                    this.makeMove(moveIndex);
                    
                    // Check for game result
                    const result = this.checkGameResult();
                    if (result) {
                        this.handleGameResult(result);
                    }
                }
            },
            
            getRandomMove() {
                const emptyCells = [];
                for (let i = 0; i < 9; i++) {
                    if (gameState.gameBoard[i] === '') {
                        emptyCells.push(i);
                    }
                }
                
                if (emptyCells.length > 0) {
                    return emptyCells[Math.floor(Math.random() * emptyCells.length)];
                }
                
                return -1;
            },
            
            getMediumAIMove() {
                // Try to win
                for (let i = 0; i < 9; i++) {
                    if (gameState.gameBoard[i] === '') {
                        gameState.gameBoard[i] = gameState.aiSymbol;
                        if (this.checkWinner() === gameState.aiSymbol) {
                            gameState.gameBoard[i] = '';
                            return i;
                        }
                        gameState.gameBoard[i] = '';
                    }
                }
                
                // Block player from winning
                for (let i = 0; i < 9; i++) {
                    if (gameState.gameBoard[i] === '') {
                        gameState.gameBoard[i] = gameState.playerSymbol;
                        if (this.checkWinner() === gameState.playerSymbol) {
                            gameState.gameBoard[i] = '';
                            return i;
                        }
                        gameState.gameBoard[i] = '';
                    }
                }
                
                // Take center if available
                if (gameState.gameBoard[4] === '') {
                    return 4;
                }
                
                // Take a corner if available
                const corners = [0, 2, 6, 8];
                const availableCorners = corners.filter(i => gameState.gameBoard[i] === '');
                if (availableCorners.length > 0) {
                    return availableCorners[Math.floor(Math.random() * availableCorners.length)];
                }
                
                // Take any available edge
                const edges = [1, 3, 5, 7];
                const availableEdges = edges.filter(i => gameState.gameBoard[i] === '');
                if (availableEdges.length > 0) {
                    return availableEdges[Math.floor(Math.random() * availableEdges.length)];
                }
                
                return -1;
            },
            
            getBestMove() {
                // Minimax algorithm for perfect play
                let bestScore = -Infinity;
                let bestMove;
                
                for (let i = 0; i < 9; i++) {
                    if (gameState.gameBoard[i] === '') {
                        gameState.gameBoard[i] = gameState.aiSymbol;
                        let score = this.minimax(gameState.gameBoard, 0, false);
                        gameState.gameBoard[i] = '';
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestMove = i;
                        }
                    }
                }
                
                return bestMove;
            },
            
            minimax(board, depth, isMaximizing) {
                const result = this.checkWinner();
                
                if (result === gameState.aiSymbol) {
                    return 10 - depth;
                } else if (result === gameState.playerSymbol) {
                    return depth - 10;
                } else if (this.isBoardFull()) {
                    return 0;
                }
                
                if (isMaximizing) {
                    let bestScore = -Infinity;
                    for (let i = 0; i < 9; i++) {
                        if (board[i] === '') {
                            board[i] = gameState.aiSymbol;
                            let score = this.minimax(board, depth + 1, false);
                            board[i] = '';
                            bestScore = Math.max(score, bestScore);
                        }
                    }
                    return bestScore;
                } else {
                    let bestScore = Infinity;
                    for (let i = 0; i < 9; i++) {
                        if (board[i] === '') {
                            board[i] = gameState.playerSymbol;
                            let score = this.minimax(board, depth + 1, true);
                            board[i] = '';
                            bestScore = Math.min(score, bestScore);
                        }
                    }
                    return bestScore;
                }
            },
            
            checkGameResult() {
                const winner = this.checkWinner();
                
                if (winner) {
                    return winner === gameState.playerSymbol ? 'win' : 'loss';
                } else if (this.isBoardFull()) {
                    return 'draw';
                }
                
                return null;
            },
            
            checkWinner() {
                const winPatterns = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
                    [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
                    [0, 4, 8], [2, 4, 6]             // Diagonals
                ];
                
                for (let pattern of winPatterns) {
                    const [a, b, c] = pattern;
                    if (gameState.gameBoard[a] && 
                        gameState.gameBoard[a] === gameState.gameBoard[b] && 
                        gameState.gameBoard[a] === gameState.gameBoard[c]) {
                        return gameState.gameBoard[a];
                    }
                }
                
                return null;
            },
            
            isBoardFull() {
                return gameState.gameBoard.every(cell => cell !== '');
            },
            
            handleGameResult(result) {
                gameState.gameActive = false;
                gameState.gameResult = result;
                
                // Stop timer for timed mode
                if (gameState.currentMode === 'timed') {
                    this.stopTimer();
                }
                
                // Calculate XP earned
                let xpEarned = 0;
                if (result === 'win') {
                    xpEarned = 20;
                    
                    // Bonus for timed mode based on time
                    if (gameState.currentMode === 'timed') {
                        const timeBonus = Math.max(0, 10 - Math.floor(this.timeElapsed / 10));
                        xpEarned += timeBonus;
                    }
                    
                    // Bonus for XP Rush mode
                    if (gameState.currentMode === 'xp-rush') {
                        xpEarned += 20;
                    }
                } else if (result === 'draw') {
                    xpEarned = 10;
                } else {
                    xpEarned = 5;
                }
                
                // Add XP and record result
                gameState.addXP(xpEarned);
                gameState.recordResult(result, gameState.currentMode);
                
                // Highlight winning cells if there's a winner
                if (result !== 'draw') {
                    this.highlightWinningCells();
                }
                
                // Show results popup after a delay
                setTimeout(() => {
                    screenManager.showResults(result, xpEarned);
                }, 1000);
            },
            
            highlightWinningCells() {
                const winPatterns = [
                    [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
                    [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
                    [0, 4, 8], [2, 4, 6]             // Diagonals
                ];
                
                for (let pattern of winPatterns) {
                    const [a, b, c] = pattern;
                    if (gameState.gameBoard[a] && 
                        gameState.gameBoard[a] === gameState.gameBoard[b] && 
                        gameState.gameBoard[a] === gameState.gameBoard[c]) {
                        
                        // Add winning class to these cells
                        const cells = document.querySelectorAll('.cell');
                        cells[a].classList.add('winning-cell');
                        cells[b].classList.add('winning-cell');
                        cells[c].classList.add('winning-cell');
                        break;
                    }
                }
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Create particle background
            createParticleBackground();
            
            // Initialize game state
            gameState.init();
            
            // Initialize screen manager
            screenManager.init();
            
            // Set up username submission
            document.getElementById('username-submit').addEventListener('click', () => {
                const usernameInput = document.getElementById('username');
                const username = usernameInput.value.trim();
                const errorElement = document.getElementById('username-error');
                
                // Validate username
                if (username === '') {
                    errorElement.textContent = 'Username cannot be empty.';
                    errorElement.style.display = 'block';
                    usernameInput.classList.add('error');
                    return;
                }
                
                if (!/^[a-zA-Z0-9]+$/.test(username)) {
                    errorElement.textContent = 'Invalid username. Only letters and numbers allowed.';
                    errorElement.style.display = 'block';
                    usernameInput.classList.add('error');
                    return;
                }
                
                // Save username and proceed
                gameState.username = username;
                gameState.saveToStorage();
                gameState.updateUI(); // Force UI update
                screenManager.showScreen('dashboard-screen');
            });
            
            // Set up edit profile button
            document.getElementById('edit-profile').addEventListener('click', () => {
                screenManager.showScreen('username-screen');
            });
            
            // Set up game controls
            document.getElementById('restart-game').addEventListener('click', () => {
                gameManager.initGame();
            });
            
            document.getElementById('main-menu').addEventListener('click', () => {
                screenManager.showScreen('dashboard-screen');
            });
            
            // Set up settings
            document.getElementById('sound-toggle').addEventListener('change', (e) => {
                gameState.soundEnabled = e.target.checked;
                gameState.saveToStorage();
                gameState.updateAudio();
            });
            
            document.getElementById('music-toggle').addEventListener('change', (e) => {
                gameState.musicEnabled = e.target.checked;
                gameState.saveToStorage();
                gameState.updateAudio();
            });
            
            document.getElementById('animations-toggle').addEventListener('change', (e) => {
                gameState.animationsEnabled = e.target.checked;
                gameState.saveToStorage();
            });
            
            document.getElementById('vibration-toggle').addEventListener('change', (e) => {
                gameState.vibrationEnabled = e.target.checked;
                gameState.saveToStorage();
            });
            
            document.getElementById('tutorial-toggle').addEventListener('change', (e) => {
                gameState.tutorialEnabled = e.target.checked;
                gameState.saveToStorage();
            });
            
            document.getElementById('reset-progress').addEventListener('click', () => {
                if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                    gameState.resetProgress();
                }
            });
            
            document.getElementById('change-username').addEventListener('click', () => {
                screenManager.showScreen('username-screen');
            });
        });

        // Particle background animation
        function createParticleBackground() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size
                const size = Math.random() * 20 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random position
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                // Random animation delay and duration
                particle.style.animationDelay = `${Math.random() * 15}s`;
                particle.style.animationDuration = `${15 + Math.random() * 10}s`;
                
                particlesContainer.appendChild(particle);
            }
        }
    </script>
</body>
</html>
